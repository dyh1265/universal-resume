FROM node:20-alpine AS build

WORKDIR /app

COPY package*.json ./
RUN if [ -f package-lock.json ]; then npm ci; else npm install; fi

COPY tailwind.css postcss.config.js tailwind.config.js ./
COPY docs ./docs
RUN npm run build

FROM python:3.11-slim

WORKDIR /app

COPY cv_chat/requirements.txt ./
RUN pip install --no-cache-dir -r requirements.txt

COPY cv_chat ./cv_chat
COPY --from=build /app/docs ./docs

ENV PORT=8080

CMD ["gunicorn", "-w", "2", "-b", "0.0.0.0:8080", "cv_chat.app:app"]
